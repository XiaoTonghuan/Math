# 加法原则和乘法原则

加法原则：设$\set{S_1,...,S_n}$是集合S的**划分**，S中元素的个数为$|S| = \sum_{i=1}^{n}|S_i|$

- 注意划分的概念
- 应用加法原则的技巧就是合理的划分问题

乘法原则：令S是序偶$\langle a_1,a_2,...,a_n\rangle$的集合，第i个元素有$r_i$种选择，S中共有$r_1\times r_2\times ...\times r_n$种选择

- 运用乘法原则，后步的结果可随前步的结果而变化，但是数量不能随前步的变化而变化，不依赖任何一步

# 集合的排列和组合

**排列数**：从含n个**不重复元素**的集合S中，选取r个元素排成一列，叫做S的一个排列，记为
$$
P_n^r = \frac{n!}{r!}
$$
**组合数**：从含n个**不重复元素**的集合S中选取r个元素，组成S的一个子集，叫做S的一个组合，记为
$$
C_n^r =\frac{P_n^r}{r!} = \frac{n!}{r!(n-r)!}
$$
推论：$C_{n}^r = C_n^{n-r}$

证明：$C_n^0 + \dots + C_n^n = 2^n$

法一：二项式定理

法二：分别使用加法原理和乘法原理解题，在使用乘法原理的情况下，依次考虑每一个元素，他们均有两个状态，故为$2^n$，使用加法原理的情况下，分成n+1类考虑

> P.S. 双计数是组合数学中很重要的一种手段 

**圆排列**：从含n个**不重复元素**的集合S中，选出r个排成一圈，叫做S的一个环形排列
$$
\frac{P_n^r}{r} = \frac{n!}{(n-r)!r}
$$

**不相邻元素的组合**：对序列$\{ 1,...,n\}$从中取出r个不相邻的元素，称**不相邻的r组合**？

设该序列为单调增序列$B=\{b_1,...,b_r\}$，**元素之间的差值**$\ge 2$，让所有元素减去自己的**指标**$\{0,1,...r-1\}$，即$B'=\{b_1,b_2-1,...b_r-r+1\}$，显然，该序列是单调递增的，记为$C=\{c_1,...c_r\}$，**那么**，$\max{C}\le n-r+1,\min C \ge 1$，所以相当于是从1 - n-r+1之中选出r个，即
$$
C_{n-r+1}^{r} = \binom{n-r+1}{r}\\
$$
例：某保密装置要同时使用若干把不同的钥匙才能开锁，现有7人，须四人到场才能开锁，每个人持有若干钥匙，问至少有多少把不同的锁？没人至少持几把钥匙？

1. 分析：每3个人至少缺一把钥匙，若至少两人缺的钥匙是一样的，那么4个人可能会缺钥匙，所以任意3个人缺的钥匙互不相同，从7个人中任选3个，公有$\binom{7}{3}\\$种不同的钥匙，即这些锁。
2. 任意四个人都不缺钥匙，那么对于任意一个人来说，从剩下的人中任选3个人，他们缺的钥匙我都应该有，他们任选3个人最少缺1把钥匙，所以他们总的缺钥匙的可能数为$\binom{6}{3}=20\\$



# 重集的排列和组合

**重集**：元素可以多次出现的集合叫**重集**，元素的出现次数称**重数**

**定理**：重集$\set{\infty \cdot a_1,...,\infty \cdot a_k}$的**r排列**$k^r$

证明：考虑有限的位置，即考虑每个元素的可能选择，都有k种可能，一共考虑r次

**定理**：重集 $\{n_1\cdot a_1,...,n_k\cdot a_k\}$，$n = n_1+n_2+...+n_k$的**全排列**
$$
P(n;n_1,...,n_k)=\frac{n!}{n_1!\cdot n_2!\cdot ... \cdot n_k!}
$$
证明：对于**有重复元素**的全排列，应当将那些重复元素的顺序除掉

- 可以用这个思路理解以下二项式定理，即$(x+y)^n = C_n^r x^r y^{n-r}$，其中的某一项为r个x和n-r和y个排列，那么这样排列的系数是，排列的个数，即$P(n;r,n-r)x^r y^{n-r} = C_n^rx^ry^{n-r}$，竟然发现$C_n^r = P(n;r,n-r)$

- 以此类推可以得出：
  $$
  (x_1 +\dots +x_n)^n = \sum P(n;r_1 ,\dots ,r_n) x^{r_1}x^{r_2}\dots x_n ^{r_n}
  $$

**定理**：重集$\set{\infty \cdot a_1,...,\infty \cdot a_k}$的r组合数
$$
C_{r+k-1}^r = \frac{(k-1 + r )!}{(k-1)!r!}
$$
证明：设其一个组合为$M=\set{x_1\cdot a_1 ... x_k \cdot a_k}$，$x_1+...+x_k = r$，问题转化为，这个方程有多少非负整数解的问题，可以使用挡板法解决，即将问题转化为r个1分成k份的问题，将k-1个挡板和r个1全排列，然后去掉他们两种元素的顺序即可

**定理**：重集$S=\set{\infty \cdot a_1,...,\infty \cdot a_k}$，要求每个元素至少出现一次的组合数
$$
C_{r-1}^{r-k}
$$
证明：同上面的问题，使用换元法，得
$$
x_1 + x_2 +...+x_k = r - k\\
\frac{(k-1 +r-k)}{(k-1)!(r-k)!} = C_{r-1}^{r-k}
$$

# 分配问题(盒子放球)

## 球和盒子都不同

- 把r个不同球放到k个不同的盒子里，球**都放**，盒子可以为空，方案数$k^r$

  证明：考虑r个球，每个球都有k个选择，得证

- r个不同球放到k个不同的盒子里，第i个盒子中放$r_i$个，$r_1+r_2+\cdot+r_k = r$，则

  方案数：
  $$
  P(r;r_1,\dots,r_n) = \frac{r!}{r_1!\dots r_k!}
  $$
  证明1：隔板法

  证明2：转化为重集的全排列

## 球相同盒子不同

- 把r个**相同的球**放到k个不同的盒子里，每个盒子既可以放也可以不放，所有可能的方案数为
  $$
  C_{k+r-1}^r = \frac{(k+r-1)!}{r!(k-1)!}
  $$
  证明：把r个球放进k个盒子里，相当于求方程$x_1 + x_2 +\dots +x_n = r$所有解的个数

# 排列的生成算法

## 全排列的个数问题

全排列的个数相当之多共有n!个排列，当n趋近于无穷时，根据Stirling数，可以得到
$$
\lim_{n\rightarrow +\infty}\frac{n!}{\sqrt{2\pi n}(\frac{n}{e})^n} = 1
$$

## 字典序法

保持前缀不变的基础下，慢慢增加后缀

- 从右向左进行扫描，找到第一次下降的位置
- 后缀中比当前位置大的最小的数字进行交换
- 保证后缀最小

例：求839647521的下一个排列

首先从右向左找到单调递减处，即4处，然后将4和他后面比他大的最小的数进行交换，原数列变为839657421，保证后缀最小，所以下一个排列为8396**51247**

## SJT算法

可移动数：对于某一个方向上的所有数，若这个数字大于他在这个方向上的相邻数，则称他为**可移动数**

- 规定一个方向，
- 找到最大的可移动数，将他向某个方向移动直到不能再进行移动
- 找到第二大的可移动数，将他向相同的方向移动**一次**
- 将比这个数大的所有数字更改方向
- 重复第二步

```c++
int SJT(int k,int n)//k为生成的第k个排列，n为序列的长度
{
    vector<int>a(n+1);
    for(int i=1; i<=n; i++) a[i]=i; //第一轮初始是1-n
    vector<int>d(n+1);
    for(int i=1; i<=n; i++) d[i]=-1; //方向全部朝左，每个数可以按照它的方向移动一步
    for(int r=1; r<=k-1; ++r) //第一轮已经结束，要找第k轮结果，还要进行k-1轮
    {
        int mobile_int=0;//目前最大可移动数
        int pos=0;//这个可移动数的位置
        for(int i=1; i<=n; i++)//寻找最大可移动数
        {
            int j=i+d[i];//将要走到的位置
            if(j==0||j>n||a[j]>a[i]) continue;//不能到最左边边界，也不能到最右边边界，一个数不能跨过比它大的数
            if(a[i]>mobile_int)
            {
                mobile_int=a[i];
                pos=i;
            }
        }
        int tpos=pos+d[pos];//可移动数的下一步的位置
        swap(a[pos],a[tpos]);//交换数字
        swap(d[pos],d[tpos]);//交换方向
        for(int i=1; i<=n; i++)
            if(a[i]>mobile_int) d[i]=-d[i];//大于最大可移动数的数a[i]的方向d[i]要取反
    }
    for(int i=1; i<=n; ++i) print("%d",a[i]);
    return 0;
}
```

# 组合的生成算法

# 二项式系数

组合数$C_n^r$又叫二项式系数，可以写成$\binom{n}{r}$

## 二项式相关的公式、恒等式

- pascal公式
  $$
  C_n^k = C_n^{k-1} +C_{n-1}^{k-1}
  $$

- $$
  C_n^k = \frac{n}{k}C_{n-1}^{k-1}
  $$
  
- $$
  C_n^r C_r^k = C_n^k C_{n-k}^{r-k}
  $$
  
  证明：先从n各元素中选出r，然后从r个元素中选出k个，他不和直接选出k个相等，而是有重复的，可以先从n个元素中直接选出k个，然后再在剩余的元素中选出一部分添加到那k个元素中，构成r个元素
  
- 二项式定理
  $$
  (x + y )^n  = \sum_{k = 0}^{n}C_n^k x^k y ^{n-k}
  $$
  证明：参照上面的组合数部分

- $$
  C_n^0 + C_n ^1 + C_n^2+\dots +C_n^n = 2^n
  $$

- $$
  C_n ^0+C_n^2 +\dots += C_n ^1+C_n^3 + \dots +
  $$

  证明1：二项式定理中，令x=-1，y=1可得

  证明2：考虑有n个元素的集合$\set{1,\dots ,n}$，考虑每个元素是否出现，每一个元素的可能性为2，当考虑到最后一个元素的时候，如果已经出现了偶数个数字，最后一个数字不取，如果已经取了奇数个数字，那么最后一个数字取，总共的可能数为$2\cdot2\cdot 2\dots 2\cdot 1 = 2^n$，而我们已经知道，集合中的所有元素的组合数为$2^n$，所以，奇组合数的个数和偶组合数的个数是相等的

- $$
  (C_n^0)^2 + (C_n ^1)^2 + \dots + (C_n ^n )^2 = C_{2n}^n
  $$

  证明：考虑均有两个元素的集合$A = \set{a_1 ,\dots ,a_n},B=\set{b_1 ,\dots b_n }$，考虑他们并集的所有n组合数，即$C_{2n}^n$，等号左侧是加法，所以对集合A中出现的元素个数进行分类讨论，如果在A中取了0个元素，那么在B中取了n个元素，所以总的组合数为$C_n^0 C_n^n = (C_n^0)^2$，剩下的类似

- $$
  C_m^0 C_n^r + C_m^1 C_n^{r-1} +\dots + C_m^r C_n^0 = C_{m+n}^r
  $$

  证明的方法和上面类似

- $$
  C_{m+n}^m = C_{m+n-1}^{m-1} + C_{m+n-1}^m
  $$

  证明：依然采用集合的方式，构造两个集合$A=\set{a_1\dots a_m},B=\set{b_1 \dots,b_n}$，考虑集合A中的某个元素在不在取出的数中，当存在时再从剩下的m+n-1个数字中取m-1个即可，当这个元素不存在时，再从剩下的元素中取出m个

- $$
  C_{m+n}^2 = mn + C_n^2  + C_m^2
  $$

  依然使用集合的思想，本次我们将所有的取法分成三类。第一类是从集合A中取2个，第二类是从集合B中取两个，第三类是从集合A和B中各取一个

- $$
  C_{m+n+1}^m = C_n^0 + C_{n+1}^1 + C_{n+2}^2 +\dots + C_{m+n}^m
  $$

  证明：构造重集$\set{\infty \cdot 1 , \infty \cdot 2,\dots ,\infty \cdot (n+2)}$的m组合数为$C_{m+n+1}^m$

  依然进行分类讨论，将所有的组合分成m+1类，考虑集合中包含1的个数，不含1时，即$C_{n+m}^{m}$当包含一个1时，考虑这个集合不含1的m-1组合，为$C_{n+m-1}^{m-1}$，剩下的以此类推

组合数公式和一些求和公式有一定的关系，且和这个公式有着很大的关系，如
$$
C_{n}^2 = 1 + \dots + n = \frac{n(n-1)}{2}\\
$$
证明：
$$
\begin{aligned}
1+2+3 +\dots + n = & C_{1}^{1} + C_{2}^{1} +\dots  +C_{n}^{1}\\
=& C_{1}^{0} + C_{2}^{1} + \dots +C_{n}^{n-1}\\
=& C_{1+n+1}^{n}\\
=& C_{n}^{2}
\end{aligned}
$$
再如：
$$
1\times 2 + 2\times 3 + 3\times 4 + 4 \times5 + \dots +n(n+1) = \frac{n(n+1)(n+2)}{3}\\
\begin{aligned}
& 1\times 2 + 2\times 3 + 3\times 4 + 4\times 5 + \dots + n(n+1) \\
= &2(1 + 3 + \dots + \frac{n(n+1)}{2})\\
=& 2(C_2^2 + C_3^2 + \dots +C_{n}^2)\\
=& 2(C_2 ^0 + C_3^1 + C_4^2 + \dots + C_{n}^{n-2})\\
= & 2C_{1 + 2 + n-1} ^{n-1}\\
= & \frac{n(n+1)(n+2)}{3}
\end{aligned}
$$
可以发现这个公式的特点，以便于应用，其特点为，=右边的所有项中，底下的数字和上面的数字每过一项便增加1，直到增加到m

- $$
  C_{0}^{k} + C_{1}^{k} + C_{2} ^{k} + \dots + C_{n}^{k} = C_{n+1} ^{k+1}
  $$

  这个公式高中见过，他的特点是，上面的数字是一样的，然后，下面的数每一次都自增1，=的右边，比等号左边的最后一项上下都多1，证明如下

  构造集合$\set{1,\dots ,n+1}$，取他的k+1 组合数，依然分类讨论，分成n+1类，这n+1类是，含1，不含1，但是含2，不含1，2，但是含3……，当含1的时候，组合数为$C_n^k$，以此类推可以证明
  
- $$
  \sum _{k=1} ^{n} kC_{n}^{k} = n 2^{n-1}\\
  prove:
  \begin{aligned}
  (1 + x) ^ n = & \sum_{k=1}^{n}C_{n}^k x^k \\
  n(1+x)^{n-1} =& \sum_{k=1}^n C_{n}^k k x^{k-1}\\ 
  \end{aligned}
  $$

- $$
  C_n^mC_m ^k  = C_n^k C_{n-k}^{m-k}
  $$

- $$
  \sum_{k=m}^n (-1)^{n-k}C_n^k C_k^m = \begin{cases}1 & n=m\\ 0 & n > m\end{cases}
  $$

## 二项式反演公式

设$a_n,b_n$是两个数列，若对于任意不小于s的整数n，都有
$$
a_n = \sum _{k= s}^n C_n ^k b_k
$$
则
$$
\sum _{k=s} ^ {n}(-1)^{n-k}C_n ^ k a_k  =  b_n
$$
（这公式还挺优美的）

反之也成立

例：设g(m,n)表示m个元素组成的集合到n个元素组成集合的满射的个数，求g(m,n)

对产生的所有映射进行分类讨论

可能产生的所有映射的个数为$n^m$个，假设值域中元素的个数为k，那么根据k对映射进行分类，且每个类别中的映射都是满射，那么
$$
n^m = \sum_{k=1}^{n} C_{n}^{k}g(m,k)
$$
根据二项式反演公式，有
$$
g(m,n) = \sum_{k=1}^{n} (-1)^{n-k} C_n^k k^m
$$
例：用m种颜色涂1$\times n$的棋盘，每个格子涂一种颜色，h(m,n)表示恰好用上m种颜色涂满n个棋盘的种数，求h(m,n)

根据用上的颜色种数进行分类讨论，可以分成用上1，2...m种的，所以有
$$
\sum _ {k=2}^{m}C_m^kh(k,n) = m(m-1)^{n-1} 
$$
根据二项式反演公式，有
$$
h(m,n) = \sum_{k=2}^{m} (-1)^{m-k} C_m^k k(k-1)^{n-1}
$$

## 二项式公式的推广

多项式定理前面已经说过，现在不再赘述

牛顿二项式定理：

对一切实数
$$
(1+x)^{\alpha} = \sum_{k=0}^{\infty} C_\alpha ^k x ^k \quad C_\alpha ^k  = \frac{\alpha (\alpha -1) ...(\alpha - k  + 1)}{k!}
$$





# 一些基本方法的使用

- 插空法和捆绑法

  1. 10个男孩和5个女孩站成一排，无两个女孩相邻。

     女孩不相邻，插男孩的空$A_{11}^5\cdot A_{10}^{10}$

  2. 10个男孩和5个女孩站成一圆圈，无两个女孩相邻。

     $P_{10}^5 \cdot P_{10}^{10}$

  3. 五个红色的珠子和3个蓝色的主子装在圆板的四周，红（蓝）色珠子之间互不相同，试问有多少种方案，如果要求蓝色珠子在一起，有多少种排列方案

     - 相当于是每一个珠子都不一样$P_8^8$
     - 蓝色珠子在一起$P_5^5\cdot5\cdot A_3^3$

- 分类讨论

  在1到300中选三个不同的数，并且这三个数之和能被3整除，问有多少种方式？
  $$
  分类讨论所有的可能性\\
  1. 0 0 0\\
  2. 1 1 1
  3. 2 2 2
  3. 1 2 0
  所以
  3\cdot C_{300}^3+ C_{100}^1C_{100}^1C_{100}^1
  $$

# 组合恒等式的证明方法

归纳法

代数法

排列和组合的两个基本模型是**球盒模型**和**格路模型**

利用组合恒等式

# 练习A

- 从某班3个男生，3个女生拍成一圈，男女交替就坐，一共有多少种可能性。
  $$
  先考虑男生的环排列，然后考虑女生的插空，女生插孔时，不能按照全排列，因为男生的原因，女生的排头和排尾能够被区分出来\\
  P_3^3A_3^3 = 12
  $$

- 用七颗彩珠串成长链，可串出多少种不同的长链（假定六彩珠取之不尽）

  考虑每一个位置都有6种可能，故$6^7$

- 至少用两种颜色的六彩珠串成7珠环链，求环链的种数

  去除所有可能的全部相同的种数，再除开头的顺序

  $(6^7-6)/7$

- 从包含苹果、橙子、和梨的框子里选4个水果。如果不关心选择水果的顺序，且只关心水果的类型，那么当框中**每类水果至少有4个**时有多少种选法？ 

  问题转化为四个相同的元素放到三个不同的框子中，框子允许空，有多少种方法，用挡板法

  $\frac{A_6^6}{A_2^2 \cdot A_4^4}$

- 从包含1美元、2美元、5美元、10美元、20美元、50美元及100美元的钱袋中选5张纸币，有多少种方式？假定不管纸币被选的次序，同种币值的纸币都是不加区别的，并且至少每张纸币有5张。

  相当于5个纸币放到7个盒子里面

  $\frac{A_{11}^{11}}{A_6^5\cdot A_5^5}$

- 方程$x1+x2+x3 =11$有多少个解？其中$x1,x2,x3$是非负整数。

  相当于11个球放到3个盒子里面

  $C_{11+3-1}^{11}$

- 书架上摆放着12本书，从中选出五本，这五本书两两不相邻，问有多少种选择的方法

  这12本书本身是有序的，我们将排序得到的位次的顺序作为这12本书的顺序

  想当于5个竖线，每个竖线中间放入了一个*，然后将剩下的3个\*放入6个空中，这个问题等价于3个相同的球放入6个不同的盒子中

  $C_{3 + 6-1}^{3} = 56$
  
- 9个不同的汽车走6个入口，一共有多少种情况？

  相当于9个汽车和5个隔板的全排列，即$S=\{1\cdot a_1,...,1\cdot a_9 ,5\cdot \delta \}$的全排列，即
  $$
  \frac{14!}{1!\cdot ...\cdot1!\cdot 5!}
  $$

- 有a、b、c、d各四个，任取10个，每种至少两个，一共有多少种排列

  $S =\set{4\cdot a,4\cdot b,4\cdot c,4\cdot d}$，先每种选两个，即$\frac{8!}{2!2!2!2!}$，第二步考虑剩下的两种，分情况讨论，第一种，选两个一样的，4种，第二种，两个不一样的，$C_4^2$种，故
  $$
  P(8;2,2,2,2)(4+C_4^2)
  $$
  
- 4个相同的橘子和6个不同的苹果分给5个同学，问每个同学分得2个水果的概率是多少

  分两步三类，第一步分橘子，第二步分苹果，根据橘子分成3种情况讨论，苹果根据橘子的情况确定
  $$
  C_5^2\cdot P_6^3 +3 \cdot C_5^2 \cdot P(6;1,1,2,2)+5\cdot P(6;1,1,1,1,2)
  $$

- 重集$S=\set{6\cdot a,5\cdot b,4\cdot c,3\cdot d}$，d不相邻，求可能的排列

  插空法，注意d是没顺序的
  $$
  P(15;6,5,4)\cdot C_{16}^3
  $$

# 练习B

- 求至少出现一个6，且能被3整除的 5位数的个数

  本题解题的关键是将所有的数，**根据除以3的余数划分成3个等价类**，即余1的，余2的，余0的，所有的五位数共有99999+1-10000 = 90000个，其中被三整除的有90000/3=30000个，接下来考虑不含6的可以被3整数的数字，第一位除了不能选6还不能选0，因此是8种选择的方案，对后面的每一位进行考虑，接下来的三位都有9种可能，考虑最后一位的情况，前面所有的数字组成的4位数总共有三种情况，即被三整除，余1，余2，被3整除时最后一位可以选择3、6、9，余1时可以选择2、5、8，余2时可以选1、4、7，**发现不改变选择的种数**，所以，总的可能数就是$30000-8\times 9\times 9 \times 9\times 3 $

- S是n个元素的集合，求S的奇组合和偶组合的个数

  由二项式定理，令x=1，y=-1，得到，奇组合和偶组合的个数是相等的，所以他们的个数都是$2^{n-1}$

- 一次聚会上有2n个人，自由组合形成n对，有多少种方案

  相当于把2n个不同的球，放到n个不同的盒子里，每个盒子有2个，直接带公式
  $$
  \frac{(2n)!}{2!\times \dots\times 2!}
  $$

- 50!结尾有几个0？

  由唯一分解定理$50! = 2^{k_1}3^{k_2}5^{k_3}...$，可见若是要产生10，就要求因子10的个数，而10的个数被5的个数制约，所以就是求5的个数，1-50中一共有12个因子5（25和50有两个）

